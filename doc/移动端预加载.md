# 移动端预加载方案

本文意在简单的科普然后介绍一下我们现在项目中使用的方案预加载方案

## [prefetch](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Link_prefetching_FAQ)

prefetch是一种浏览器机制，其利用浏览器空闲时间来下载或预取用户在不久的将来可能访问的文档。网页向浏览器提供一组预取提示，并在浏览器完成当前页面的加载后开始静默地拉取指定的文档并将其存储在缓存中。当用户访问其中一个预取文档时，便可以快速的从浏览器缓存中得到。

```html
<link rel="prefetch" href="/images/big.jpeg">
```

[Can I use](https://caniuse.com/#feat=link-rel-prefetch)

## [preload](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Preloading_content)

 `<link>` 元素的 rel 属性的属性值preload能够让你在你的HTML页面中 `<head>`元素内部书写一些声明式的资源获取请求，可以指明哪些资源是在页面加载完成后即刻需要的。对于这种即刻需要的资源，你可能希望在页面加载的生命周期的早期阶段就开始获取，在浏览器的主渲染机制介入前就进行预加载。这一机制使得资源可以更早的得到加载并可用，且更不易阻塞页面的初步渲染，进而提升性能。本文提供了一个如何有效使用preload机制的基本说明。

```html
 <link rel="preload" href="style.css" as="style">
<link rel="preload" href="main.js" as="script">
 ``` 

[Can I use](https://caniuse.com/#search=preload)

## prefetch & preload 小结

上文主要截取了MDN上的文章简要介绍一下prefetch和preload的特性，看起来其实都还不错但是兼容性有些堪忧对于多数的业务开发看起来是并不能投入使用的，如果想了解更多关于 prefetch和 preload 的细节可以阅读文章底部的参考链接

## webpack对prefetch 和 preload的支持

现在大多数人都是使用`webpack`做为构建工具如果你所参与的项目只需要兼容较高的版本的浏览器那么你可以轻松的依靠webpack 完成预加载功能

### webpack 魔法注释

通过添加内联的注释赋予`import()`动态加载语法更多牛逼的特性，比如给chunk命名，使用不同的webpackMode，prefetch，preload 等。

```js
import(
  /* webpackInclude: /\.json$/ */
  /* webpackExclude: /\.noimport\.json$/ */
  /* webpackChunkName: "my-chunk-name" */  `赋予 chunk 指定的名字`
  /* webpackMode: "lazy" */  `这个是默认值使用import()你什么也不加默认就是这个mode`
  /* webpackPrefetch: true */ `赋予 chunk prefetch能力`
  /* webpackPreload: true */`赋予 chunk preload能力`
  `./locale/${language}`
);
```

### webpack魔法注释占位符

在 webpack 2.6.0 支持俩个占位符`[index]`和`[request]`一个是自增id，一个是变量匹配的文件名

## 参考

[一箩筐的预加载技术](http://www.alloyteam.com/2015/10/prefetching-preloading-prebrowsing/)
[prefetch和预加载实践](https://juejin.im/entry/5bed4612e51d4528a14e076e)
[preload,prefetch 和它们在chrome中的优先级](https://juejin.im/post/58e8acf10ce46300585a7a42)
